<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AsmanDip Future Trade Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            background-color: #f4f6f9;
        }
        .card {
            border-radius: 15px;
        }
        .status-running {
            color: green;
            font-weight: bold;
        }
        .status-stopped {
            color: red;
            font-weight: bold;
        }
        table {
            font-size: 14px;
        }
    </style>
</head>
<body>
<div class="container py-4">
    <h1 class="text-center mb-4">üöÄ AsmanDip Future Trade Dashboard</h1>

    <!-- Bot Status -->
    <div class="card mb-4">
        <div class="card-body">
            <h4>‡¶¨‡¶ü ‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏: <span id="bot-status" class="status-running">Loading...</span></h4>
        </div>
    </div>

    <!-- Crypto Prices -->
    <div class="card mb-4">
        <div class="card-body">
            <h4>üíπ ‡¶≤‡¶æ‡¶á‡¶≠ ‡¶ï‡ßç‡¶∞‡¶ø‡¶™‡ßç‡¶ü‡ßã ‡¶™‡ßç‡¶∞‡¶æ‡¶á‡¶∏</h4>
            <div id="crypto-prices" class="row mt-3"></div>
        </div>
    </div>

    <!-- Signal History -->
    <div class="card mb-4">
        <div class="card-body">
            <h4>üìä ‡¶∏‡¶ø‡¶ó‡¶®‡ßç‡¶Ø‡¶æ‡¶≤ ‡¶π‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡¶ø</h4>
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>‡¶∏‡¶Æ‡ßü</th>
                        <th>‡¶™‡ßá‡ßü‡¶æ‡¶∞</th>
                        <th>‡¶ü‡¶æ‡¶á‡¶™</th>
                        <th>‡¶è‡¶®‡ßç‡¶ü‡ßç‡¶∞‡¶ø</th>
                        <th>‡¶ü‡¶æ‡¶∞‡ßç‡¶ó‡ßá‡¶ü</th>
                        <th>SL</th>
                    </tr>
                </thead>
                <tbody id="signal-history"></tbody>
            </table>
        </div>
    </div>

    <!-- PnL Chart -->
    <div class="card mb-4">
        <div class="card-body">
            <h4>üìà ‡¶™‡ßç‡¶∞‡¶´‡¶ø‡¶ü & ‡¶≤‡¶∏</h4>
            <canvas id="pnlChart" height="100"></canvas>
        </div>
    </div>
</div>

<script>
async function loadBotStatus() {
    let res = await fetch('/api/bot-status');
    let data = await res.json();
    document.getElementById('bot-status').textContent = data.status;
    document.getElementById('bot-status').className = data.status === 'Running' ? 'status-running' : 'status-stopped';
}

async function loadCryptoPrices() {
    let res = await fetch('/api/prices');
    let prices = await res.json();
    let html = '';
    for (let coin of prices) {
        html += `<div class="col-md-3">
                    <div class="card p-2 text-center">
                        <h5>${coin.symbol}</h5>
                        <p class="fw-bold">$${coin.price}</p>
                    </div>
                 </div>`;
    }
    document.getElementById('crypto-prices').innerHTML = html;
}

async function loadSignalHistory() {
    let res = await fetch('/api/signals');
    let signals = await res.json();
    let html = '';
    for (let s of signals) {
        html += `<tr>
                    <td>${s.time}</td>
                    <td>${s.symbol}</td>
                    <td>${s.type}</td>
                    <td>${s.entry}</td>
                    <td>${s.target}</td>
                    <td>${s.sl}</td>
                 </tr>`;
    }
    document.getElementById('signal-history').innerHTML = html;
}

async function loadPnLChart() {
    let res = await fetch('/api/pnl');
    let pnlData = await res.json();
    new Chart(document.getElementById('pnlChart'), {
        type: 'line',
        data: {
            labels: pnlData.dates,
            datasets: [{
                label: 'PnL ($)',
                data: pnlData.values,
                borderColor: 'green',
                backgroundColor: 'rgba(0,255,0,0.1)',
                fill: true
            }]
        }
    });
}

// Auto Refresh Every 5s
setInterval(() => {
    loadBotStatus();
    loadCryptoPrices();
    loadSignalHistory();
    loadPnLChart();
}, 5000);

// Initial Load
loadBotStatus();
loadCryptoPrices();
loadSignalHistory();
loadPnLChart();
</script>
</body>
</html>