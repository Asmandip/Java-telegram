<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AsmanDip Crypto Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background: #121212;
            color: #fff;
        }
        .price-up { color: #00ff88; }
        .price-down { color: #ff4444; }
        .table-container {
            overflow-x: auto;
        }
        .header-title {
            text-align: center;
            padding: 15px;
            font-size: 24px;
            font-weight: bold;
        }
        #searchInput {
            margin-bottom: 15px;
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <div class="header-title">üíπ ‡¶≤‡¶æ‡¶á‡¶≠ ‡¶ï‡ßç‡¶∞‡¶ø‡¶™‡ßç‡¶ü‡ßã ‡¶°‡ßç‡¶Ø‡¶æ‡¶∂‡¶¨‡ßã‡¶∞‡ßç‡¶°</div>

        <input type="text" id="searchInput" class="form-control" placeholder="üîç ‡¶ï‡ßü‡ßá‡¶® ‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßÅ‡¶®...">

        <div class="table-container">
            <table class="table table-dark table-hover">
                <thead>
                    <tr>
                        <th>‡¶ï‡ßü‡ßá‡¶®</th>
                        <th>‡¶™‡ßç‡¶∞‡¶æ‡¶á‡¶∏ (USDT)</th>
                        <th>‡ß®‡ß™ ‡¶ò‡¶®‡ßç‡¶ü‡¶æ‡¶∞ ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶®</th>
                    </tr>
                </thead>
                <tbody id="cryptoTable">
                    <tr>
                        <td colspan="3" class="text-center">Loading...</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <script>
        const tableBody = document.getElementById('cryptoTable');
        const searchInput = document.getElementById('searchInput');
        let coinsData = {};

        async function fetchPrices() {
            try {
                const res = await fetch('/api/prices');
                const data = await res.json();
                renderTable(data);
            } catch (err) {
                console.error("Error fetching prices:", err);
            }
        }

        function renderTable(data) {
            const search = searchInput.value.toLowerCase();
            tableBody.innerHTML = '';

            data.forEach(coin => {
                if (coin.symbol.toLowerCase().includes(search)) {
                    const prevPrice = coinsData[coin.symbol]?.price || 0;
                    const priceClass = prevPrice === 0 ? '' :
                        coin.price > prevPrice ? 'price-up' :
                        coin.price < prevPrice ? 'price-down' : '';

                    tableBody.innerHTML += `
                        <tr>
                            <td>${coin.symbol}</td>
                            <td class="${priceClass}">${coin.price.toFixed(4)}</td>
                            <td class="${coin.change24h > 0 ? 'price-up' : 'price-down'}">
                                ${coin.change24h.toFixed(2)}%
                            </td>
                        </tr>
                    `;

                    coinsData[coin.symbol] = { price: coin.price };
                }
            });
        }

        searchInput.addEventListener('input', () => renderTable(Object.values(coinsData)));

        setInterval(fetchPrices, 5000);
        fetchPrices();
    </script>
</body>
</html>
