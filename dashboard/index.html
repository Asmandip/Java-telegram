<!doctype html>
<html lang="bn">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>AsmanDip â€” Dashboard</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
  body{background:#0f1724;color:#e5e7eb}
  .card{background:#111827;border-radius:12px}
  .small-muted{color:#9ca3af;font-size:13px}
  .tag{background:#0ea5a4;color:#042f2e;padding:4px 8px;border-radius:8px}
</style>
</head>
<body>
<div class="container py-4">
  <h2 class="mb-3">ðŸš€ AsmanDip Algo Dashboard</h2>

  <div class="row g-3">
    <div class="col-md-4">
      <div class="card p-3">
        <h6>Bot Status</h6>
        <p id="botStatus">Loading...</p>
        <button id="btnToggleScan" class="btn btn-sm btn-success">Stop Scanner</button>
      </div>

      <div class="card p-3 mt-3">
        <h6>Settings</h6>
        <div class="mb-2 small-muted">Timeframe</div>
        <input id="tf" class="form-control mb-2" value="3m">
        <div class="mb-2 small-muted">Confirmations required</div>
        <input id="confReq" type="number" class="form-control mb-2" value="3">
        <button id="saveSettings" class="btn btn-primary btn-sm">Save</button>
      </div>
    </div>

    <div class="col-md-8">
      <div class="card p-3">
        <h6>Live Candidates</h6>
        <div id="candidatesList">Loading...</div>
      </div>

      <div class="card p-3 mt-3">
        <h6>Signal History</h6>
        <table class="table table-dark table-striped">
          <thead><tr><th>Time</th><th>Pair</th><th>Side</th><th>Price</th><th>Confs</th></tr></thead>
          <tbody id="history"></tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<script>
const apiBase = '/api'; // if your server exposes /api routes; else adjust
async function fetchSettings(){
  try{
    const r = await fetch('/api/settings');
    return await r.json();
  }catch(e){return null;}
}
async function saveSettings(){
  const tf = document.getElementById('tf').value;
  const conf = parseInt(document.getElementById('confReq').value,10);
  await fetch('/api/settings',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({timeframe:tf, confirmations:conf})});
  alert('Saved');
}
document.getElementById('saveSettings').addEventListener('click', saveSettings);

async function loadCandidates(){
  const r = await fetch('/latest-scan');
  const j = await r.json();
  const div = document.getElementById('candidatesList');
  if(!j || !j.length){ div.innerHTML = '<div class="small-muted">No candidates</div>'; return; }
  div.innerHTML = j.map(c=>`<div class="p-2 mb-2" style="background:#0b1220;border-radius:8px">
    <b>${c.symbol}</b> â€” ${c.side} â€” <span class="tag">${c.price}</span>
    <div class="small-muted">${c.confirmations.join(', ')}</div>
  </div>`).join('');
}
async function loadHistory(){
  const r = await fetch('/api/signals');
  const j = await r.json();
  const tb = document.getElementById('history');
  tb.innerHTML = j.map(s=>`<tr><td>${new Date(s.createdAt).toLocaleString()}</td><td>${s.pair||s.symbol||s.pair}</td><td>${s.type||s.side||s.side}</td><td>${s.price||s.entry||''}</td><td>${(s.confirmations||s.indicators||[]).length}</td></tr>`).join('');
}

document.getElementById('btnToggleScan').addEventListener('click', async ()=>{
  // call server toggle (implement endpoint /api/scan-toggle)
  await fetch('/api/scan-toggle',{method:'POST'});
  location.reload();
});

setInterval(()=>{ loadCandidates(); loadHistory(); }, 5000);
loadCandidates(); loadHistory();
</script>
</body>
</html>
